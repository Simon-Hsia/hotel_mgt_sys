"use strict";(self["webpackChunkhotel_frontend"]=self["webpackChunkhotel_frontend"]||[]).push([[195],{2034:function(t,e,o){o.d(e,{A:function(){return m}});var r=function(){var t=this,e=t._self._c;return e("header",{staticClass:"page-header"},[e("h1",{staticClass:"title"},[t._v(t._s(t.title))]),e("p",{staticClass:"intro"},[t._v(t._s(t.intro))]),e("div",{staticClass:"line"})])},a=[],l={name:"hotel-header",props:{title:{type:String,required:!0,default:"默认标题"},intro:{type:String,default:"简单介绍当前模块的内容"}}},s=l,i=o(1656),n=(0,i.A)(s,r,a,!1,null,null,null),m=n.exports},6317:function(t,e,o){o.r(e),o.d(e,{default:function(){return x}});var r=function(){var t=this,e=t._self._c;return t.showDetails?e("Details",{attrs:{roomData:t.roomData,statusFilterArr:t.statusFilterArr,roomtypeFilterArr:t.roomtypeFilterArr},on:{hideDetails:function(e){return t.viewDetails(!1)}}}):e("el-container",{staticClass:"room-container"},[e("Header",{attrs:{title:t.pageTitle,intro:t.pageIntro}}),e("Bigbox"),e("div",{staticClass:"search-box"},[e("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:function(e){t.addRoomDialog=!0}}},[t._v("新增房间")]),e("el-dialog",{attrs:{title:"新增房间",visible:t.addRoomDialog,center:""},on:{"update:visible":function(e){t.addRoomDialog=e}}},[e("el-form",{attrs:{model:t.roomForm,"label-position":"left","label-width":"80px"}},[e("el-form-item",{attrs:{label:"房号"}},[e("el-input",{attrs:{autocomplete:"off"},model:{value:t.roomForm.roomnum,callback:function(e){t.$set(t.roomForm,"roomnum",e)},expression:"roomForm.roomnum"}})],1),e("el-form-item",{attrs:{label:"状态"}},[e("el-select",{attrs:{placeholder:"请选择"},model:{value:t.roomForm.status,callback:function(e){t.$set(t.roomForm,"status",e)},expression:"roomForm.status"}},t._l(t.statusFilterArr,(function(t){return e("el-option",{key:t.value,attrs:{label:t.text,value:t.value}})})),1)],1),e("el-form-item",{attrs:{label:"房间类型"}},[e("el-select",{attrs:{placeholder:"请选择"},model:{value:t.roomForm.roomtype,callback:function(e){t.$set(t.roomForm,"roomtype",e)},expression:"roomForm.roomtype"}},t._l(t.roomtypeFilterArr,(function(t){return e("el-option",{key:t.value,attrs:{label:t.text,value:t.value}})})),1)],1),e("el-form-item",{attrs:{label:"门锁编码"}},[e("el-input",{attrs:{autocomplete:"off"},model:{value:t.roomForm.lockcode,callback:function(e){t.$set(t.roomForm,"lockcode",e)},expression:"roomForm.lockcode"}})],1),e("el-form-item",{attrs:{label:"房间图片"}},[e("el-upload",{attrs:{action:"#","auto-upload":!1,"on-change":t.handlePreview,"show-file-list":!1,accept:"image/*"}},[e("el-button",[t._v("选择图片")])],1),t.roomForm.roompic?e("img",{staticStyle:{"max-width":"200px","margin-top":"20px"},attrs:{src:t.roomForm.roompic}}):t._e()],1)],1),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.addRoomDialog=!1}}},[t._v("取 消")]),e("el-button",{attrs:{type:"primary"},on:{click:t.addRoomFn}},[t._v("确 定")])],1)],1),e("el-input",{staticClass:"search-ipt",attrs:{placeholder:"输入查询关键字"},model:{value:t.search,callback:function(e){t.search=e},expression:"search"}}),e("el-button",{attrs:{type:"danger",icon:"el-icon-minus"},on:{click:t.delRoomsConfirm}},[t._v("注销房间")])],1),e("el-table",{ref:"roomsTable",staticStyle:{width:"100%"},attrs:{data:t.roomsList,"highlight-selection-row":""},on:{"selection-change":t.selectListener}},[e("el-table-column",{attrs:{type:"selection",width:"90",align:"center"}}),e("el-table-column",{attrs:{prop:"id",label:"ID",width:"90",align:"center",sortable:""}}),e("el-table-column",{attrs:{prop:"roomnum",label:"房号",align:"center",sortable:""}}),e("el-table-column",{attrs:{prop:"roomtype",label:"房型",align:"center",filters:t.roomtypeFilterArr,"filter-method":t.filterHandler}}),e("el-table-column",{attrs:{prop:"status",label:"状态",align:"center",filters:t.statusFilterArr,"filter-method":t.filterHandler},scopedSlots:t._u([{key:"default",fn:function({row:o}){return[e("el-tag",{staticStyle:{width:"50%",height:"90%","font-size":"medium","text-align":"center"},attrs:{type:t.getStatusClass(o.status),effect:"dark"}},[t._v(t._s(o.status))])]}}],null,!1,3866777608)}),e("el-table-column",{attrs:{prop:"roomerid",label:"当前所属",align:"center"},scopedSlots:t._u([{key:"default",fn:function({row:e}){return[t._v(" "+t._s(e.roomername)+" ")]}}],null,!1,1398738608)}),e("el-table-column",{attrs:{label:"操作",align:"center"},scopedSlots:t._u([{key:"default",fn:function({row:o}){return[e("el-button",{attrs:{size:"medium",type:"primary"},on:{click:function(e){return t.viewDetails(!0,o)}}},[t._v(" 查看详情 ")])]}}],null,!1,3430136852)})],1)],1)},a=[],l=(o(8111),o(2489),o(116),o(1701),o(3579),o(3518)),s=o(2034),i=o(3022),n=function(){var t=this,e=t._self._c;return e("div",{staticClass:"details-container"},[e("div",{staticClass:"nav-bar"},[e("el-button",{staticClass:"go-back",attrs:{icon:"el-icon-back",circle:""},on:{click:t.goBack}})],1),e("div",{staticClass:"main"},[e("div",{staticClass:"left-section"},[e("el-form",{attrs:{model:t.roomForm,"label-position":"left","label-width":"80px"}},[e("el-form-item",[e("el-button",{attrs:{type:"primary",disabled:!t.changeFormSign},on:{click:function(e){return t.submitForm()}}},[t._v("更新")]),e("el-button",{on:{click:function(e){return t.emptyForm()}}},[t._v("清空")])],1),e("el-form-item",{attrs:{label:"房间ID"}},[e("el-input",{attrs:{value:t.roomForm.id,autocomplete:"off",disabled:!0}})],1),e("el-form-item",{attrs:{label:"房号"}},[e("el-input",{attrs:{autocomplete:"off"},model:{value:t.roomForm.roomnum,callback:function(e){t.$set(t.roomForm,"roomnum",e)},expression:"roomForm.roomnum"}})],1),e("el-form-item",{attrs:{label:"状态"}},[e("el-select",{attrs:{placeholder:"请选择"},model:{value:t.roomForm.status,callback:function(e){t.$set(t.roomForm,"status",e)},expression:"roomForm.status"}},t._l(t.statusFilterArr,(function(t){return e("el-option",{key:t.value,attrs:{label:t.text,value:t.value}})})),1)],1),e("el-form-item",{attrs:{label:"当前所属"}},[e("el-input",{attrs:{autocomplete:"off"},model:{value:t.roomForm.roomername,callback:function(e){t.$set(t.roomForm,"roomername",e)},expression:"roomForm.roomername"}})],1),e("el-form-item",{attrs:{label:"房间类型"}},[e("el-select",{attrs:{placeholder:"请选择"},model:{value:t.roomForm.roomtype,callback:function(e){t.$set(t.roomForm,"roomtype",e)},expression:"roomForm.roomtype"}},t._l(t.roomtypeFilterArr,(function(t){return e("el-option",{key:t.value,attrs:{label:t.text,value:t.value}})})),1)],1),e("el-form-item",{attrs:{label:"门锁编码"}},[e("el-input",{attrs:{autocomplete:"off"},model:{value:t.roomForm.lockcode,callback:function(e){t.$set(t.roomForm,"lockcode",e)},expression:"roomForm.lockcode"}})],1),e("el-form-item",{attrs:{label:"房卡ID"}},[e("el-input",{attrs:{autocomplete:"off"},model:{value:t.roomForm.cardid,callback:function(e){t.$set(t.roomForm,"cardid",e)},expression:"roomForm.cardid"}})],1),e("el-form-item",{attrs:{label:"房间图片"}},[e("el-upload",{attrs:{action:"#","auto-upload":!1,"on-change":t.handlePreview,"show-file-list":!1,accept:"image/*"}},[e("el-button",[t._v("选择图片")])],1),t.roomForm.roompic?e("img",{staticStyle:{"max-width":"200px","margin-top":"20px"},attrs:{src:t.roomForm.roompic}}):t._e()],1)],1)],1),e("div",{staticClass:"right-section"},[e("el-input",{staticClass:"search-ipt",attrs:{placeholder:"输入查询关键字"},model:{value:t.search,callback:function(e){t.search=e},expression:"search"}}),e("el-table",{staticClass:"log-table",staticStyle:{width:"100%"},attrs:{data:t.roomLog}},[e("el-table-column",{attrs:{prop:"id",label:"序号",width:"80",align:"center",sortable:""}}),e("el-table-column",{attrs:{prop:"cardid",label:"房卡ID",align:"center",sortable:""}}),e("el-table-column",{attrs:{prop:"roomnum",label:"房号",align:"center",sortable:""}}),e("el-table-column",{attrs:{prop:"cardtype",label:"房卡类型",align:"center",filters:t.cardtypeFilterArr,"filter-method":t.filterHandler}}),e("el-table-column",{attrs:{prop:"holdername",label:"姓名",align:"center"}}),e("el-table-column",{attrs:{prop:"time",label:"时间",align:"center",width:"200",sortable:""},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t._f("formatTimeFilter")(e.row.time))+" ")]}}])})],1)],1)])])},m=[],c=(o(7588),o(4166)),u=o(1576),d=o.n(u);const p=c.A.room;var h={name:"hotel-details",props:["roomData","statusFilterArr","roomtypeFilterArr"],data(){return{roomForm:this.roomData,changeFormSign:!1,cardtypeFilterArr:[{text:"员工卡",value:"员工卡"},{text:"房客卡",value:"房客卡"}],search:""}},computed:{...(0,l.L8)(["swipeLog"]),roomLog(){return this.search?this.swipeLog.filter((t=>Object.keys(t).some((e=>("time"===e&&(t[e]=d()(t[e]).format("YYYY-MM-DD HH:mm:ss")),t[e]&&t[e].toString().includes(this.search)))))):this.swipeLog}},filters:{formatTimeFilter(t){return t?d()(t).format("YYYY-MM-DD HH:mm:ss"):""}},methods:{goBack(){this.changeFormSign?this.$confirm("变更未提交，确定返回吗","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.$emit("hideDetails")})).catch((()=>{})):this.$emit("hideDetails")},handlePreview(t){const e=new FileReader;e.onload=()=>{this.roomForm.roompic=e.result},e.readAsDataURL(t.raw)},filterHandler(t,e,o){const r=o.property;return e[r]===t},async submitForm(){let t=!0;const e={...this.roomForm};e.roomid=Number(this.roomForm.id),delete e.id,e.cardid=Number(e.cardid)||null,["无",""].includes(e.roomername)&&(e.roomername=null);for(const r in e)if(["",void 0,"无",null,!1].includes(e[r])&&!["roomername","cardid"].includes(r)){this.$message.warning(`${r}不能为空`),t=!1;break}if(!t)return;const{data:o}=await p.ReqUpdateRoomData(e);0===o.status?(this.changeFormSign=!1,this.$store.dispatch("getRoomsData"),this.$store.dispatch("getSwipeLog",this.roomData.roomnum),this.$message.success(o.message)):o.data.length>0?o.data.forEach((t=>{this.$message.error(t.message)})):this.$message.error(o.message)},emptyForm(){this.roomForm={},this.changeFormSign=!1}},watch:{roomForm:{handler(t){this.changeFormSign||"{}"===JSON.stringify(t)||(this.changeFormSign=!0)},deep:!0}},async created(){this.$store.dispatch("getSwipeLog",this.roomData.roomnum)}},f=h,g=o(1656),b=(0,g.A)(f,n,m,!1,null,"849e2266",null),F=b.exports;const v=c.A.room;var y={name:"hotel-room",components:{Header:s.A,Details:F,Bigbox:i.A},data(){return{pageTitle:"房间一览",pageIntro:"当前板块可浏览所有房间状态，并进行添加/删除房间、变更房间状态数据等操作",search:"",statusFilterArr:[{text:"空闲",value:"空闲"},{text:"已入住",value:"已入住"},{text:"已预订",value:"已预订"},{text:"待铺新",value:"待铺新"},{text:"异常",value:"异常"}],roomtypeFilterArr:[{text:"单人间",value:"单人间"},{text:"双人间",value:"双人间"},{text:"大床房",value:"大床房"}],addRoomDialog:!1,roomForm:{roomnum:"",status:"",roomtype:"",lockcode:"",roompic:""},mulSelRooms:[],showDetails:!1,roomData:{}}},computed:{...(0,l.L8)(["roomsData"]),roomsList(){const t=this.roomsData.map((t=>{const e={...t};return e.roomername=t.roomername?t.roomername:"无",e}));return this.search?t.filter((t=>Object.keys(t).some((e=>!["roompic","lockcode"].includes(e)&&(t[e]&&t[e].toString().includes(this.search)))))):t}},methods:{viewDetails(t,e){t&&(this.roomData=this.roomsData.find((t=>t.id===e.id))),this.showDetails=t},getStatusClass(t){switch(t){case"空闲":return"";case"已入住":return"success";case"已预订":return"success";case"待铺新":return"warning";case"异常":return"danger"}return""},filterHandler(t,e,o){const r=o.property;return e[r]===t},handlePreview(t){const e=new FileReader;e.onload=()=>{this.roomForm.roompic=e.result},e.readAsDataURL(t.raw)},async addRoomFn(){for(const e in this.roomForm)if(["",void 0].includes(this.roomForm[e])){this.$message.warning(`${e}不能为空`);break}const{data:t}=await v.ReqAddRoom(this.roomForm);0===t.status?(this.addRoomDialog=!1,this.$store.dispatch("getRoomsData"),this.$message.success(t.message)):this.$message.error(t.message)},selectListener(t){this.mulSelRooms=t},delRoomsConfirm(){if(0===this.mulSelRooms.length)return this.$message.info("至少要选中一个房间");const t=this.mulSelRooms.map((t=>t.roomnum));this.$confirm(`确定删除${t.join("\n")}共${t.length}个房间吗?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.delRoomsFn()})).catch((()=>this.$refs.roomsTable.clearSelection()))},async delRoomsFn(){const t=this.mulSelRooms.map((async t=>{try{const{data:e}=await v.ReqDeleteRoom({roomid:t.id,roomnum:t.roomnum});return 0===e.status?e:(this.$message.error(e.message),null)}catch(e){const t=e.response;return console.error(t.message||e),null}})),e=await Promise.all(t),o=e.filter((t=>t));o.length>0?(o.length<this.mulSelRooms.length?this.$message.warning("选中的房间部分删除"):this.$message.success("选中的房间全部删除"),this.$store.dispatch("getRoomsData")):console.error("房间删除操作全部失败")}},created(){this.$store.dispatch("getRoomsData")}},w=y,k=(0,g.A)(w,r,a,!1,null,"3eca24fa",null),x=k.exports}}]);